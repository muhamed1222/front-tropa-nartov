# Flutter Mobile App - Tropa Nartov üì±

–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤, –∏—Å—Å–ª–µ–¥—É—é—â–∏—Ö –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –º–∞—Ä—à—Ä—É—Ç—ã –ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä–∏–∏.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–°–±–æ—Ä–∫–∞](#—Å–±–æ—Ä–∫–∞)

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üó∫Ô∏è **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞** —Å –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏
- üìç **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** –æ –º–µ—Å—Ç–∞—Ö (—Ñ–æ—Ç–æ, –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- üèîÔ∏è **–¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã** —Å —Ä–∞—Å—á–µ—Ç–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- ‚≠ê **–°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤** –∏ –æ—Ç–∑—ã–≤–æ–≤
- üíù **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç
- üì± **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- üåê **–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º** (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- üé® **Modern Material Design UI**

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Flutter SDK 3.0+
- Dart SDK 3.0+
- Android Studio / Xcode (–¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–æ–≤)
- Backend API (—Å–º. [../back/README.md](../back/README.md))

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–ª–∏)
git clone https://github.com/yourusername/tropa-nartov.git
cd tropa-nartov/app-new-project

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
flutter pub get

# 3. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ SERVER_IP –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
flutter run

# –ò–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
flutter run -d android
flutter run -d ios
flutter run -d chrome  # Web –≤–µ—Ä—Å–∏—è
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Flutter
flutter doctor

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
flutter devices

# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
flutter analyze
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª–µ–¥—É–µ—Ç **Clean Architecture** –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —Å feature-based –º–æ–¥—É–ª—è–º–∏.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lib/
‚îú‚îÄ‚îÄ main.dart                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ features/                   # Feature modules (Clean Architecture)
‚îÇ   ‚îú‚îÄ‚îÄ auth/                  # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/             # Data layer (repositories impl, API)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/           # Domain layer (entities, use cases)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ presentation/     # UI layer (pages, widgets, blocs)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pages/       # Screens
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ widgets/     # Reusable widgets
‚îÇ   ‚îú‚îÄ‚îÄ onboarding/           # Onboarding flow
‚îÇ   ‚îú‚îÄ‚îÄ places/               # –ú–µ—Å—Ç–∞ –∏ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ routes/               # –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ profile/              # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ core/                      # Shared functionality
‚îÇ   ‚îú‚îÄ‚îÄ router/               # Navigation (go_router)
‚îÇ   ‚îú‚îÄ‚îÄ theme/                # App theme & styles
‚îÇ   ‚îú‚îÄ‚îÄ utils/                # Helper functions
‚îÇ   ‚îî‚îÄ‚îÄ widgets/              # Common widgets
‚îú‚îÄ‚îÄ services/                  # Global services
‚îÇ   ‚îú‚îÄ‚îÄ api_service.dart      # HTTP client (Dio)
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.dart     # Authentication
‚îÇ   ‚îú‚îÄ‚îÄ location_service.dart # Geolocation
‚îÇ   ‚îî‚îÄ‚îÄ storage_service.dart  # Local storage
‚îî‚îÄ‚îÄ config/                    # Configuration
    ‚îú‚îÄ‚îÄ app_config.dart        # App-wide config
    ‚îî‚îÄ‚îÄ environment_config.dart # Environment vars
```

### –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### Data Layer
- **Repositories Implementation** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è data sources
- **Models** - data models –¥–ª—è API
- **API Clients** - HTTP –∑–∞–ø—Ä–æ—Å—ã

#### Domain Layer
- **Entities** - –±–∏–∑–Ω–µ—Å-–æ–±—ä–µ–∫—Ç—ã
- **Use Cases** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **Repository Interfaces** - –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è data layer

#### Presentation Layer
- **Pages** - –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã
- **Widgets** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **BLoC/Cubit** - state management

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment Variables (.env)

```env
# API Configuration
SERVER_IP=192.168.1.48
SERVER_PORT=8001
API_BASE_URL=http://192.168.1.48:8001

# Environment
ENVIRONMENT=development  # development | staging | production

# Feature Flags
ENABLE_LOGGING=true
ENABLE_ANALYTICS=false
```

### –ó–∞–≥—Ä—É–∑–∫–∞ .env

–ò—Å–ø–æ–ª—å–∑—É–µ–º `flutter_dotenv`:

```dart
// main.dart
import 'package:flutter_dotenv/flutter_dotenv.dart';

Future<void> main() async {
  await dotenv.load(fileName: ".env");
  runApp(MyApp());
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
final apiUrl = dotenv.env['API_BASE_URL'];
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

```bash
# Development
flutter run --dart-define=ENVIRONMENT=development

# Production
flutter run --dart-define=ENVIRONMENT=production \
            --dart-define=API_BASE_URL=https://api.tropa-nartov.ru
```

## üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### State Management

–ò—Å–ø–æ–ª—å–∑—É–µ–º **flutter_bloc** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:

```dart
// Example: Auth BLoC
class AuthBloc extends Bloc<AuthEvent, AuthState> {
  final AuthRepository authRepository;

  AuthBloc({required this.authRepository}) : super(AuthInitial()) {
    on<LoginRequested>(_onLoginRequested);
    on<LogoutRequested>(_onLogoutRequested);
  }

  Future<void> _onLoginRequested(
    LoginRequested event,
    Emitter<AuthState> emit,
  ) async {
    emit(AuthLoading());
    try {
      final user = await authRepository.login(event.email, event.password);
      emit(AuthSuccess(user));
    } catch (e) {
      emit(AuthFailure(e.toString()));
    }
  }
}
```

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ–º **go_router** –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:

```dart
// lib/core/router/app_router.dart
final appRouter = GoRouter(
  routes: [
    GoRoute(
      path: '/',
      builder: (context, state) => const WelcomeScreen(),
    ),
    GoRoute(
      path: '/login',
      builder: (context, state) => const LoginPage(),
    ),
    GoRoute(
      path: '/home',
      builder: (context, state) => const HomePage(),
    ),
    GoRoute(
      path: '/places/:id',
      builder: (context, state) {
        final id = state.pathParameters['id']!;
        return PlaceDetailPage(placeId: id);
      },
    ),
  ],
);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
context.go('/home');
context.push('/places/123');
```

### API Calls

```dart
// lib/services/api_service.dart
class ApiService {
  final Dio _dio;

  ApiService() : _dio = Dio(BaseOptions(
    baseUrl: EnvironmentConfig.apiBaseUrl,
    connectTimeout: const Duration(seconds: 30),
  ));

  Future<List<Place>> getPlaces({
    int page = 1,
    int limit = 20,
  }) async {
    try {
      final response = await _dio.get('/places', queryParameters: {
        'page': page,
        'limit': limit,
      });
      return (response.data['data'] as List)
          .map((json) => Place.fromJson(json))
          .toList();
    } on DioException catch (e) {
      throw ApiException(e.message);
    }
  }
}
```

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

```dart
// lib/services/storage_service.dart
class StorageService {
  static Future<void> saveToken(String token) async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString('auth_token', token);
  }

  static Future<String?> getToken() async {
    final prefs = await SharedPreferences.getInstance();
    return prefs.getString('auth_token');
  }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit Tests

```bash
# –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤
flutter test

# –° coverage
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
open coverage/html/index.html
```

### Widget Tests

```dart
// test/widgets/login_widget_test.dart
testWidgets('Login form should validate email', (tester) async {
  await tester.pumpWidget(MaterialApp(home: LoginPage()));
  
  // –ù–∞–π—Ç–∏ –ø–æ–ª–µ email
  final emailField = find.byKey(const Key('email_field'));
  
  // –í–≤–µ—Å—Ç–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email
  await tester.enterText(emailField, 'invalid');
  await tester.pump();
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É
  expect(find.text('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email'), findsOneWidget);
});
```

### Integration Tests

```bash
# –ó–∞–ø—É—Å–∫ integration —Ç–µ—Å—Ç–æ–≤
flutter test integration_test

# –ù–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
flutter test integration_test -d chrome
```

## üì¶ –°–±–æ—Ä–∫–∞

### Android

```bash
# Debug build
flutter build apk --debug

# Release build
flutter build apk --release

# App bundle –¥–ª—è Play Store
flutter build appbundle --release

# Output: build/app/outputs/
```

### iOS

```bash
# Debug
flutter build ios --debug

# Release
flutter build ios --release

# –¢—Ä–µ–±—É–µ—Ç—Å—è Xcode –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
```

### Web

```bash
# Build –¥–ª—è web
flutter build web --release

# Output: build/web/

# Deploy –Ω–∞ —Å–µ—Ä–≤–µ—Ä
rsync -avz build/web/ user@server:/var/www/tropa-nartov/
```

## üé® –¢–µ–º–∏–∑–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã

```dart
// lib/core/theme/app_theme.dart
class AppTheme {
  static ThemeData light() {
    return ThemeData(
      primarySwatch: Colors.blue,
      scaffoldBackgroundColor: Colors.white,
      appBarTheme: const AppBarTheme(
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
      ),
      // ... –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    );
  }

  static ThemeData dark() {
    return ThemeData.dark().copyWith(
      primaryColor: Colors.blueAccent,
      // ... dark theme –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    );
  }
}
```

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Unable to connect to API"

```dart
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. Backend –∑–∞–ø—É—â–µ–Ω (http://localhost:8001/ping)
2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π IP –≤ .env (–¥–ª—è Android —ç–º—É–ª—è—Ç–æ—Ä–∞: 10.0.2.2)
3. CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ backend
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Build failed"

```bash
# –û—á–∏—Å—Ç–∫–∞ build
flutter clean
flutter pub get
flutter run
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–í–µ—Ä—Å–∏—è Flutter —É—Å—Ç–∞—Ä–µ–ª–∞"

```bash
flutter upgrade
flutter pub upgrade
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
flutter analyze

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
dart format lib/

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ (–¥–ª—è freezed, json_serializable)
flutter pub run build_runner build --delete-conflicting-outputs

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
flutter pub upgrade

# –°–ø–∏—Å–æ–∫ outdated –ø–∞–∫–µ—Ç–æ–≤
flutter pub outdated
```

## üì± –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

- ‚úÖ Android 5.0+ (API 21+)
- ‚úÖ iOS 12.0+
- ‚úÖ Web (Chrome, Safari, Firefox)
- ‚ö†Ô∏è Desktop (Windows, macOS, Linux) - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## ü§ù Contributing

–°–º. [CONTRIBUTING.md](../CONTRIBUTING.md)

## üìÑ License

MIT License - —Å–º. [LICENSE](../LICENSE)

